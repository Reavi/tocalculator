<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</head>
<body>
<div class="container">
    <div class="title">Kalkulator</div>
    <div class="calc">
        <label>Wpisz działanie:</label><br>
        <input id="val" type="text" name="op">
        <button type="button" id="oblicz">Policz!</button>
    </div>
</div>


<div id="wynik">Wynik: <div id="wynikResult"></div></div>
<div id="mess"></div>


<form id="fileUploadForm" action="/form" ENCTYPE="multipart/form-data" method="POST" name="wibble">
    choose a file to upload:<input id="plugin" type="file" name="myfile"/><br>
    <input id="wy" type="submit"/>
</form>
<button id="fileUpload">second</button>

<div>
    <table style="width:100%">
        <tr>
            <td>|||</td>
            <td>Obsługiwane znaki</td>
            <td>Historia</td>
        </tr>
        <tr>
            <td></td>
            <td id="pluginy"></td>
            <td id="history"></td>
        </tr>
    </table>

</div>


<script>
    $(function () {
        var productAction = $("#oblicz");
        productAction.click(function () {
            ob($("#val").val());
        });
        getPluginList();
        getHistory();

    });


    function ob(value) {
        $.get("/calc", {op:value}).done(function () {
            getMess();

        });

    }
    function getValue() {
        $.getJSON("/result", function (data) {
            $("#wynikResult").text(data);
            getHistory();
            console.log(data)



        });
    }


    function getMess() {
        $.getJSON("/getmess", function (data) {

            var result = JSON.parse(data);

            if(data !== "{}"){
                $("#wynikResult").text("");
                $("#mess").text(result.ERROR);
            }else{
                getValue();
            }
        });

    }
    function getPluginList(){
        $.getJSON("/getplugins", function (string) {
            var obj=JSON.parse(string);
            console.log(obj);
            var lista=string.split(",");
            console.log(lista);
            console.log(lista.length);
            for(var i=0;i<lista.length/2;i++){
                $("#pluginy").append("<div>"+obj[i][0]+" : "+obj[i][1] +"</div>");
            }

        })
    }
    var ciag;
    function getHistory(){
        $.getJSON("/gethistory", function (string) {
            console.log(string);
            ciag=string;
            if(string!=="{}"){
                var lista=string.split(",");
                var obj=JSON.parse(string);
                $("#history").text("");
                console.log(lista.length);
                for(var i=0;i<lista.length;i++){
                    //$("#history").append("<div>"+lista[i]+"</div>");
                    $("#history").append("<div>"+obj[i][0]+"</div>");

                }
            }




        })
    }
</script>
</body>
</html>